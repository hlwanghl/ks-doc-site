---
title: "守护进程集"
---

守护进程集 (DaemonSet)，保证在每个 Node 上都运行一个容器副本，常用来部署一些集群的日志、监控或者其他系统管理应用。典型的应用场景包括：

- 日志收集，比如 Fluentd，Logstash 等。
- 系统监控，比如 Prometheus Node Exporter，collectd，New Relic agent，Ganglia gmond 等。
- 系统程序，比如 kube-proxy, kube-dns, Gluster, Ceph 等。


本节通过以下几个方面介绍如何管理守护进程集：

- 创建守护进程集
- 查看守护进程集
- 编辑守护进程集
- 删除守护进程集

## 创建守护进程集 

首先登录 KubeSphere 控制台，访问左侧菜单栏，在 **应用负载** 菜单下，点击 **守护进程集** 按钮进入列表页。选择不同的项目，就可以看到对应项目下面的所有守护进程集。如果是管理员登录，可以看到集群所有项目的守护进程集，如果是普通用户，则只能查看授权项目下的所有守护进程集。

![守护进程集 - 列表页](/daemonset_list.png)  

1. 点击右上角 **创建守护进程集** 按钮，新建一个守护进程集。 

![创建守护进程集](/daemonset_create_1.png)

目前创建守护进程集一共有三种方式，**页面创建**，**导入 yaml 文件** 创建，**代码模式** 创建。其中 **导入yaml文件** 方式会自动将 yaml 文件内容填充到页面上，用户根据需要可以在页面上调整后再行创建。**代码模式**可以方便习惯命令行操作的人员直接在页面上编辑yaml文件并创建守护进程集。

![创建守护进程集 - 代码模式](/daemonset_create_2.png)

这里重点介绍 **页面创建** 的方式。创建时需要输入守护进程集的名称并选择项目，用户还可以根据需求填写守护进程集的描述信息。

![创建守护进程集 - 基本信息](/daemonset_create_3.png)

2. 在 **容器组设置页面** 用户可以根据需求对容器组进行配置。容器组可以包含一个或者多个容器，要求输入容器的名称和对应的镜像名。如果用户有更进一步的需求，可以点击 **高级选项**。高级选项中可以对 CPU 和内存的资源使用进行限定。其中 **requests** 是集群保证分配给容器的资源，**limits** 是容器可以使用的资源的上限。超过这个限定值，容器会被 kill。用户可以通过 **命令** 和 **参数** 选项自定义容器的启动命令和启动参数。**端口** 用于指定容器需要暴露的端口，端口协议可以选择 TCP 和 UDP，用户还可以指定端口与主机端口进行绑定。**环境变量** 可以指定容器内部使用的环境变量。上述配置信息填写完成以后，点击下一步。

![创建守护进程集 - 容器组](/daemonset_create_4.png)

3. 在存储卷页面可以添加 **存储卷**，**临时存储卷**，**HostPath**。存储卷可用于持久化用户数据；保留在临时存储卷中的数据，在容器组被删除以后，也将被同步删除。HostPath 直接将主机目录挂载到容器。

![创建守护进程集 - 存储](/daemonset_create_10.png)

选择使用临时存储卷方案时要求用户输入存储卷的名称和相应的挂载点，然后点击 **挂载** 和 **确定**。

![创建守护进程集 - 临时存储](/daemonset_create_5.png)

当选择使用存储卷时，可以选择 **已有存储卷** 或者根据需求 **新建存储卷**。当选择新建存储卷时，用户需要填写存储卷的名称，选择存储类型，指定容量和访问模式。最后确定挂载点，并且点击挂载和确定。然后点击下一步。

![创建守护进程集 - 存储卷](/daemonset_create_6.png)

当选择使用 HostPath 时，用户需要填写存储卷的名称，指定 HostPath 和容器内部的挂载点，点击挂载和确定。然后点击下一步。

![创建守护进程集 - HostPath](/daemonset_create_7.png)

4. 标签设置页用于指定守护进程集对应的一组或者多组标签。

![创建守护进程集 - 标签](/daemonset_create_8.png)

5. 节点选择器页面，用户可以通过指定一组或者多组键值对来指定期望运行容器组的主机。当不指定时，将会在集群内的所有节点上启动容器组。点击右下角的创建后，集群就会按照用户的配置创建对应的守护进程集。

![创建守护进程集 - 节点选择器](/daemonset_create_9.png)
 

## 查看守护进程集详情  

* 在守护进程集列表页，点击某个守护进程集的名称，就可以进入到守护进程集详情页，可以查看守护进程集的详细信息以及守护进程集对应的各种资源。

![守护进程集 - 详情页](/daemonset_read_1.png)

* 当点击容器组列表的某一容器组时，页面会跳转到容器组的详情页。

![守护进程集 - 容器组详情页](/daemonset_read_2.png)

* 当点击容器组页面中容器列表中的某一容器时，页面会跳转到容器详情页，可以看到容器的配置信息，对应资源以及日志。在本页，用户还可以通过左上角的 **终端** 按钮进入容器内部。

![守护进程集 - 容器详情页](/daemonset_read_3.png)


## 编辑守护进程集

* 在守护进程集的列表页和详情页的更多选项中都可以编辑对应的配置文件，编辑是在代码模式下完成的，编辑完成以后，点击右下方的更新按钮，就会按照最新的配置进行更新。

![守护进程集 - 编辑1](/daemonset_update_1.png)

* 如果只是修改描述信息，可以使用守护进程集详情页左上角的 **编辑** 进行修改。

![守护进程集 - 编辑2](/daemonset_update_2.png)

## 删除守护进程集

* 在列表页最右侧的更多选项和详情页左上方的更多选项中都提供了删除功能。

![守护进程集 - 删除1](/daemonset_delete_1.png)

![守护进程集 - 删除2](/daemonset_delete_2.png)
